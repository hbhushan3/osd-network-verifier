#cloud-config
repo_update: true
package_update: true

packages:
  - docker 

runcmd:
  - sudo service docker start
  - sudo mkdir  ~/../home/test
  - echo "${USERDATA_BEGIN}" >> ~/../home/test/userdata-output
  - sudo docker pull ${VALIDATOR_IMAGE}
  # Use `|| true` to ignore failure exit codes, we want the script to continue either way
  # - [ sh, -c, 'sudo docker run --env "AWS_REGION=${AWS_REGION}" -e "START_VERIFIER=${VALIDATOR_START_VERIFIER}" -e "END_VERIFIER=${VALIDATOR_END_VERIFIER}" ${VALIDATOR_IMAGE} --timeout=${TIMEOUT} || true' 
  - sudo docker run --env "AWS_REGION=${AWS_REGION}" -e "START_VERIFIER=${VALIDATOR_START_VERIFIER}" -e "END_VERIFIER=${VALIDATOR_END_VERIFIER}" ${VALIDATOR_IMAGE} --timeout=${TIMEOUT}  >> ~/../home/test/userdata-output || echo "Failed to successfully run the docker container"
  - echo "${USERDATA_END}" >> ~/../home/test/userdata-output
  - cat ~/../home/test/userdata-output #>/dev/console

  # "sudo mkdir  ~/../home/test; sudo docker run --env 'AWS_REGION=us-east-2' -e 'START_VERIFIER=VALIDATOR START' -e 'END_VERIFIER=VALIDATOR END' 'quay.io/app-sre/osd-network-verifier:v0.1.159-9a6e0eb' --timeout='2s'  >> ~/../home/test/userdata-output || echo 'Failed to successfully run the docker container';"),

# #cloud-config
# repo_update: true
# package_update: true

# packages:
#   - docker 

# runcmd:
#   - sudo service docker start
#   - sudo mkdir  ~/../home/test
#   - echo "VALIDATOR START" >> ~/../home/test/userdata-output
#   # - sudo docker pull ${VALIDATOR_IMAGE}
#   # Use `|| true` to ignore failure exit codes, we want the script to continue either way
#   # - [ sh, -c, 'sudo docker run --env "AWS_REGION=${AWS_REGION}" -e "START_VERIFIER=${VALIDATOR_START_VERIFIER}" -e "END_VERIFIER=${VALIDATOR_END_VERIFIER}" ${VALIDATOR_IMAGE} --timeout=${TIMEOUT} || true' 
#   - sudo docker run --env 'AWS_REGION=us-east-2' -e 'START_VERIFIER=VALIDATOR START' -e 'END_VERIFIER=VALIDATOR END' 'quay.io/app-sre/osd-network-verifier:v0.1.159-9a6e0eb' --timeout='2s'  >> ~/../home/test/userdata-output || echo 'Failed to successfully run the docker container'
#   - echo "VALIDATOR END" >> ~/../home/test/userdata-output
#   - cat ~/../home/test/userdata-output #>/dev/console